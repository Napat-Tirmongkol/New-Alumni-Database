<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            margin: 0;
            font-family: 'Sarabun', sans-serif;
            background-color: #f4f6f9;
        }
        .main-content {
            margin-left: 250px; 
            padding: 20px;
            padding-top: 93px; /* 73px (Header) + 20px */
        }
    </style>
</head>
<body>

    <?!= include('Header.html'); ?>
    <?!= include('AdminSidebar.html'); ?>

    <main class="main-content" id="mainContentArea">
        </main>

    <script>
        function loadContent(pageName) {
            const contentArea = document.getElementById('mainContentArea');
            if (!contentArea) return;
            contentArea.innerHTML = '<div style="text-align:center; padding:50px;"><h2>กำลังโหลด...</h2></div>';
            google.script.run
                .withSuccessHandler(html => {
                    contentArea.innerHTML = html;
                    const scripts = contentArea.getElementsByTagName('script');
                    for (let i = 0; i < scripts.length; i++) {
                        eval(scripts[i].innerText);
                    }
                })
                .getPageContent(pageName);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const userDataString = sessionStorage.getItem('loggedInUser');
            if (userDataString) {
                const user = JSON.parse(userDataString);
                if (user.role === 'Admin') {
                    loadContent('adminDashboard');
                } else {
                    google.script.run.withSuccessHandler(url => {
                         window.top.location.href = url + '?page=dashboard';
                    }).getWebAppUrl();
                }
            } else {
                google.script.run.withSuccessHandler(url => {
                    window.top.location.href = url;
                }).getWebAppUrl();
            }
        });
    </script>
</body>
</html>