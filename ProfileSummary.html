<style>
    .profile-summary-card {
        background-color: white;
        border-radius: 0.75rem; /* 12px */
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        max-width: 800px;
        margin: auto;
        overflow: hidden;
    }
    .summary-header {
        display: flex;
        align-items: center;
        gap: 1.5rem; /* 24px */
        padding: 1.5rem; /* 24px */
        border-bottom: 1px solid #e5e7eb;
    }
    .avatar-display {
        width: 80px;
        height: 80px;
        border-radius: 9999px; /* full circle */
        background-color: #dbeafe; /* light blue */
        color: #1e40af; /* dark blue */
        font-size: 2.25rem; /* 36px */
        font-weight: 700;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-shrink: 0;
        background-size: cover;
        background-position: center;
    }
    .summary-info h2 {
        font-size: 1.5rem; /* 24px */
        font-weight: 700;
        color: #111827;
        margin: 0;
    }
    .summary-info p {
        margin-top: 0.25rem;
        color: #6b7280;
    }
    .summary-body {
        padding: 1.5rem;
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 1rem 2rem;
    }
    .summary-item {
        font-size: 0.875rem; /* 14px */
    }
    .summary-item .label {
        font-weight: 700;
        color: #4b5563;
        display: block;
        margin-bottom: 0.25rem;
    }
    .summary-item .value {
        color: #1f2937;
    }
    .summary-actions {
        padding: 1rem 1.5rem;
        background-color: #f9fafb;
        text-align: right;
    }
    .edit-btn {
        background-color: #3b82f6;
        color: white;
        font-weight: 700;
        padding: 0.5rem 1.5rem;
        border-radius: 0.375rem; /* 6px */
        border: none;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .edit-btn:hover {
        background-color: #2563eb;
    }
</style>

<div class="profile-summary-card">
    <div class="summary-header">
        <div id="summaryAvatar" class="avatar-display"></div>
        <div class="summary-info">
            <h2 id="summaryFullName"></h2>
            <p id="summaryStudentId"></p>
            <p id="summaryEmail"></p>
        </div>
    </div>
    <div class="summary-body">
        <div class="summary-item">
            <span class="label">บทบาท:</span>
            <span id="summaryRole" class="value"></span>
        </div>
        <div class="summary-item">
            <span class="label">รุ่นที่จบ:</span>
            <span id="summaryGradClass" class="value"></span>
        </div>
        <div class="summary-item">
            <span class="label">GPAX:</span>
            <span id="summaryGpa" class="value"></span>
        </div>
        <div class="summary-item">
            <span class="label">อาจารย์ที่ปรึกษา:</span>
            <span id="summaryAdvisor" class="value"></span>
        </div>
    </div>
    <div class="summary-actions">
        <button class="edit-btn" onclick="loadContent('profile')">แก้ไขข้อมูล</button>
    </div>
</div>

<script>
    function displayProfileSummary() {
        const userDataString = sessionStorage.getItem('loggedInUser');
        const userEmail = sessionStorage.getItem('userEmail');
        
        // ดึงข้อมูลโปรไฟล์ทั้งหมดมาแสดง
        if (userEmail) {
            google.script.run.withSuccessHandler(profileData => {
                if (userDataString && profileData) {
                    const user = JSON.parse(userDataString);

                    // --- ส่วน Header ---
                    document.getElementById('summaryFullName').textContent = `${profileData.Prefix || ''} ${user.firstName} ${user.lastName}`;
                    document.getElementById('summaryStudentId').textContent = `รหัสนักศึกษา: ${profileData.StudentID || 'N/A'}`;
                    document.getElementById('summaryEmail').textContent = userEmail;
                    
                    // --- ส่วน Avatar ---
                    const avatarDiv = document.getElementById('summaryAvatar');
                    if (profileData.profilePictureUrl) {
                        avatarDiv.style.backgroundImage = `url('${profileData.profilePictureUrl}')`;
                        avatarDiv.textContent = ''; // ลบตัวอักษรออกถ้ามีรูป
                    } else {
                        avatarDiv.style.backgroundImage = '';
                        avatarDiv.textContent = user.firstName ? user.firstName.charAt(0).toUpperCase() : '?';
                    }

                    // --- ส่วน Body ---
                    document.getElementById('summaryRole').textContent = user.role || 'N/A';
                    document.getElementById('summaryGradClass').textContent = profileData.GraduationClass || 'N/A';
                    document.getElementById('summaryGpa').textContent = profileData.GPAX || 'N/A';
                    document.getElementById('summaryAdvisor').textContent = profileData.Advisor || 'N/A';
                }
            }).getUserProfile(userEmail);
        }
    }

    // เรียกฟังก์ชันให้ทำงานทันทีที่ Script นี้ถูกโหลด
    displayProfileSummary();
</script>