<style>
    .profile-form-container { background-color: white; padding: 20px 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .profile-header { display: flex; align-items: center; gap: 20px; margin-bottom: 25px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
    .avatar-upload { position: relative; flex-shrink: 0; }
    .avatar-preview { width: 80px; height: 80px; border-radius: 50%; background-color: #e9ecef; background-size: cover; background-position: center; border: 2px solid #ddd; }
    .avatar-upload label { position: absolute; bottom: 0; right: 0; width: 30px; height: 30px; background-color: #007bff; color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
    #profilePictureUpload { display: none; }
    .profile-header-text h2 { margin: 0 0 5px 0; }
    .profile-header-text p { margin: 0; color: #6c757d; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px 25px; }
    .form-group { display: flex; flex-direction: column; }
    .form-group label { margin-bottom: 5px; font-weight: bold; color: #555; font-size: 14px; }
    .form-group input, .form-group select, .form-group textarea { padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; font-family: 'Sarabun', sans-serif; width: 100%; box-sizing: border-box; }
    .form-group textarea { resize: vertical; min-height: 80px; }
    .form-actions { text-align: right; margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }
    .btn { padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; margin-left: 10px; }
    .save-btn { background-color: #28a745; color: white; }
    .save-btn:disabled { background-color: #aaa; cursor: not-allowed; }
    .back-btn { background-color: #6c757d; color: white; }
    .section-header { margin-top: 30px; margin-bottom: 10px; font-size: 18px; font-weight: bold; color: #333; padding-bottom: 8px; grid-column: 1 / -1; }
</style>

<div class="profile-form-container">
    <form id="profileForm">
        <div class="profile-header">
            <div class="avatar-upload">
                <div id="avatarPreview" class="avatar-preview"></div>
                <label for="profilePictureUpload">üì∑</label>
                <input type="file" id="profilePictureUpload" accept="image/jpeg, image/png, image/gif">
            </div>
            <div class="profile-header-text">
                <h2 id="profileNameDisplay">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h2>
                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô</p>
            </div>
        </div>
        
        <div class="form-grid">
            <div class="form-group"><label for="prefix">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label><select id="prefix"><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option><option>‡∏ô‡∏≤‡∏¢</option><option>‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option><option>‡∏ô‡∏≤‡∏á</option></select></div>
            <div class="form-group"><label for="studentId">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤/‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤ (7 ‡∏´‡∏•‡∏±‡∏Å)</label><input type="text" id="studentId" pattern="[0-9]{7}" maxlength="7"></div>
            <div class="form-group"><label for="firstNameTH">‡∏ä‡∏∑‡πà‡∏≠ (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)</label><input type="text" id="firstNameTH"></div>
            <div class="form-group"><label for="lastNameTH">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)</label><input type="text" id="lastNameTH"></div>
            <div class="form-group"><label for="firstNameEN">‡∏ä‡∏∑‡πà‡∏≠ (‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)</label><input type="text" id="firstNameEN"></div>
            <div class="form-group"><label for="lastNameEN">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)</label><input type="text" id="lastNameEN"></div>
            <div class="form-group"><label for="gradClass">‡∏£‡∏∏‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏ö</label><input type="text" id="gradClass" placeholder="‡πÄ‡∏ä‡πà‡∏ô LXVI, 66, ‡∏£‡∏∏‡πà‡∏ô‡∏ó‡∏µ‡πà 66"></div>
            <div class="form-group"><label for="advisor">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤</label><input type="text" id="advisor"></div>
            <div class="form-group"><label for="dob">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</label><input type="date" id="dob"></div>
            <div class="form-group"><label for="gender">‡πÄ‡∏û‡∏®</label><select id="gender"><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option><option>‡∏ä‡∏≤‡∏¢</option><option>‡∏´‡∏ç‡∏¥‡∏á</option><option>‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</option></select></div>
            <div class="form-group"><label for="birthCountry">‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î</label><input type="text" id="birthCountry"></div>
            <div class="form-group"><label for="nationality">‡∏™‡∏±‡∏ç‡∏ä‡∏≤‡∏ï‡∏¥</label><input type="text" id="nationality"></div>
            <div class="form-group"><label for="race">‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ä‡∏≤‡∏ï‡∏¥</label><input type="text" id="race"></div>
            <div class="form-group"><label for="email">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label><input type="email" id="email" readonly style="background-color:#e9ecef;"></div>
            <div class="form-group"><label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label><input type="tel" id="phone"></div>
            <div class="form-group"><label for="gpax">‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏™‡∏∞‡∏™‡∏° (GPAX)</label><input type="number" id="gpax" step="0.01" min="0" max="4"></div>
            <div class="form-group">
                <label for="employmentStatus">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</label>
                <select id="employmentStatus">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                    <option>‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
                    <option>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏≤‡∏á‡∏≤‡∏ô</option>
                    <option>‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πà‡∏≠</option>
                    <option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                </select>
            </div>
            <div class="form-group" style="grid-column: 1 / -1;"><label for="address">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label><textarea id="address"></textarea></div>

            <div class="section-header">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏ì‡∏µ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</div>
            <div class="form-group"><label for="emergencyName">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input type="text" id="emergencyName"></div>
            <div class="form-group"><label for="emergencyRelation">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</label><input type="text" id="emergencyRelation"></div>
            <div class="form-group"><label for="emergencyPhone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label><input type="tel" id="emergencyPhone"></div>

            <div class="section-header">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</div>
            <div class="form-group" style="grid-column: 1 / -1;"><label for="awards">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</label><textarea id="awards" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•, ‡∏õ‡∏µ, ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏ö"></textarea></div>
            <div class="form-group"><label for="futurePlan">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï</label><select id="futurePlan"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</option><option value="hospital_public">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏±‡∏ê</option><option value="hospital_private">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô</option><option value="clinic">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å</option><option value="community_health">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</option><option value="home_care">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô</option><option value="elderly_care">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</option><option value="occupational_health">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢</option><option value="education">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤/‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</option><option value="research">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢</option><option value="entrepreneur">‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</option><option value="international">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</option><option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option></select></div>
            <div class="form-group"><label for="educationPlan">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πà‡∏≠</label><select id="educationPlan"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πà‡∏≠</option><option value="no_plan">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πà‡∏≠</option><option value="master_nursing">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option><option value="master_public_health">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó ‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option><option value="master_health_admin">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</option><option value="master_midwifery">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó ‡∏Å‡∏≤‡∏£‡∏ú‡∏î‡∏∏‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå</option><option value="master_mental_health">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï</option><option value="master_community">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</option><option value="master_critical_care">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡∏Å‡∏§‡∏ï</option><option value="master_pediatric">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏î‡πá‡∏Å</option><option value="master_geriatric">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</option><option value="phd_nursing">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option><option value="certificate">‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£</option><option value="international">‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πà‡∏≠‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</option><option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option></select></div>
            <div class="form-group"><label for="internationalPlan">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏õ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</label><select id="internationalPlan"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</option><option value="no_plan">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡πÑ‡∏õ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</option><option value="usa">‡∏™‡∏´‡∏£‡∏±‡∏ê‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤</option><option value="canada">‡πÅ‡∏Ñ‡∏ô‡∏≤‡∏î‡∏≤</option><option value="australia">‡∏≠‡∏≠‡∏™‡πÄ‡∏ï‡∏£‡πÄ‡∏•‡∏µ‡∏¢</option><option value="uk">‡∏™‡∏´‡∏£‡∏≤‡∏ä‡∏≠‡∏≤‡∏ì‡∏≤‡∏à‡∏±‡∏Å‡∏£</option><option value="germany">‡πÄ‡∏¢‡∏≠‡∏£‡∏°‡∏ô‡∏µ</option><option value="netherlands">‡πÄ‡∏ô‡πÄ‡∏ò‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏ô‡∏î‡πå</option><option value="sweden">‡∏™‡∏ß‡∏µ‡πÄ‡∏î‡∏ô</option><option value="norway">‡∏ô‡∏≠‡∏£‡πå‡πÄ‡∏ß‡∏¢‡πå</option><option value="singapore">‡∏™‡∏¥‡∏á‡∏Ñ‡πÇ‡∏õ‡∏£‡πå</option><option value="japan">‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô</option><option value="south_korea">‡πÄ‡∏Å‡∏≤‡∏´‡∏•‡∏µ‡πÉ‡∏ï‡πâ</option><option value="uae">‡∏™‡∏´‡∏£‡∏±‡∏ê‡∏≠‡∏≤‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏°‡∏¥‡πÄ‡∏£‡∏ï‡∏™‡πå</option><option value="saudi_arabia">‡∏ã‡∏≤‡∏≠‡∏∏‡∏î‡∏µ‡∏≠‡∏≤‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢</option><option value="qatar">‡∏Å‡∏≤‡∏ï‡∏≤‡∏£‡πå</option><option value="kuwait">‡∏Ñ‡∏π‡πÄ‡∏ß‡∏ï</option><option value="new_zealand">‡∏ô‡∏¥‡∏ß‡∏ã‡∏µ‡πÅ‡∏•‡∏ô‡∏î‡πå</option><option value="other">‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option></select></div>
            <div class="form-group" style="justify-content: center;"><label style="flex-direction: row; cursor:pointer; align-items: center; display:flex; gap: 8px;"><input type="checkbox" id="willTakeThaiLicense" style="width: auto;"><span>‡∏à‡∏∞‡∏™‡∏≠‡∏ö‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û‡∏Ç‡∏≠‡∏á‡πÑ‡∏ó‡∏¢</span></label></div>
        </div>

        <div class="form-actions">
            <button type="button" class="btn back-btn" onclick="loadContent('profileSummary')">‚¨ÖÔ∏è ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            <button type="submit" id="saveButton" class="btn save-btn">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
    </form>
</div>

<script>
    let profilePictureBase64 = null;
    let profilePictureMimeType = null;
    let existingPictureId = null;

    document.getElementById('profilePictureUpload').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                document.getElementById('avatarPreview').style.backgroundImage = `url('${event.target.result}')`;
                const result = event.target.result;
                profilePictureMimeType = result.split(';')[0].split(':')[1];
                profilePictureBase64 = result.split(',')[1];
            }
            reader.readAsDataURL(file);
        }
    });

    document.getElementById('profileForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const saveButton = document.getElementById('saveButton');
        saveButton.disabled = true;
        saveButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
        
        const profileData = {
            prefix: document.getElementById('prefix').value,
            studentId: document.getElementById('studentId').value,
            firstNameTH: document.getElementById('firstNameTH').value,
            lastNameTH: document.getElementById('lastNameTH').value,
            firstNameEN: document.getElementById('firstNameEN').value,
            lastNameEN: document.getElementById('lastNameEN').value,
            gradClass: document.getElementById('gradClass').value,
            advisor: document.getElementById('advisor').value,
            dob: document.getElementById('dob').value,
            gender: document.getElementById('gender').value,
            birthCountry: document.getElementById('birthCountry').value,
            nationality: document.getElementById('nationality').value,
            race: document.getElementById('race').value,
            phone: document.getElementById('phone').value,
            gpax: document.getElementById('gpax').value,
            employmentStatus: document.getElementById('employmentStatus').value,
            address: document.getElementById('address').value,
            emergencyName: document.getElementById('emergencyName').value,
            emergencyRelation: document.getElementById('emergencyRelation').value,
            emergencyPhone: document.getElementById('emergencyPhone').value,
            awards: document.getElementById('awards').value,
            futurePlan: document.getElementById('futurePlan').value,
            educationPlan: document.getElementById('educationPlan').value,
            internationalPlan: document.getElementById('internationalPlan').value,
            willTakeThaiLicense: document.getElementById('willTakeThaiLicense').checked,
            profilePicture: profilePictureBase64,
            mimeType: profilePictureMimeType,
            existingPictureId: existingPictureId
        };
        
        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏≠‡πá‡∏≠‡∏ö‡πÄ‡∏à‡∏Å‡∏ï‡πå profileData ---
        const userEmailForSave = sessionStorage.getItem('selectedUserEmail') || sessionStorage.getItem('userEmail');
        profileData.email = userEmailForSave;

        if (!profileData.email) {
            alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            saveButton.disabled = false;
            saveButton.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            return;
        }
        
        google.script.run
        .withSuccessHandler(function(result) {
            alert(result); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"
            // --- ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î Modal ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å ---
            if (result === "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!") {
                closeModal();
            }
        })
        .withFailureHandler(function(error) {
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
        })
        .saveUserProfile(profileData)
        .finally(() => {
            saveButton.disabled = false;
            saveButton.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        });
    });

    function loadProfileData() {
        const userEmail = sessionStorage.getItem('selectedUserEmail') || sessionStorage.getItem('userEmail');
        if (userEmail) {
            google.script.run.withSuccessHandler(populateForm).getUserProfile(userEmail);
        }
    }

    function populateForm(data) {
        if (!data) {
            const userEmail = sessionStorage.getItem('selectedUserEmail') || sessionStorage.getItem('userEmail');
            document.getElementById('email').value = userEmail || '';
            return;
        };
        
        const setValue = (id, value) => {
            const element = document.getElementById(id);
            if (element) {
                element.value = value || '';
            }
        };

        setValue('prefix', data.Prefix);
        setValue('studentId', data.StudentID);
        setValue('firstNameTH', data.FirstNameTH);
        setValue('lastNameTH', data.LastNameTH);
        setValue('firstNameEN', data.FirstNameEN);
        setValue('lastNameEN', data.LastNameEN);
        setValue('gradClass', data.GraduationClass);
        setValue('advisor', data.Advisor);
        if (data.DateOfBirth) {
            try { setValue('dob', new Date(data.DateOfBirth).toISOString().split('T')[0]); } catch (e) {}
        }
        setValue('gender', data.Gender);
        setValue('birthCountry', data.BirthCountry);
        setValue('nationality', data.Nationality);
        setValue('race', data.Race);
        setValue('email', data.Email);
        setValue('phone', data.PhoneNumber);
        setValue('gpax', data.GPAX);
        setValue('employmentStatus', data.EmploymentStatus);
        setValue('address', data.CurrentAddress);
        setValue('emergencyName', data.EmergencyContactName);
        setValue('emergencyRelation', data.EmergencyContactRelation);
        setValue('emergencyPhone', data.EmergencyContactPhone);
        setValue('awards', data.Awards);
        setValue('futurePlan', data.FutureWorkPlan);
        setValue('educationPlan', data.EducationPlan);
        setValue('internationalPlan', data.InternationalWorkPlan);

        const thaiLicenseCheckbox = document.getElementById('willTakeThaiLicense');
        if (thaiLicenseCheckbox) {
            thaiLicenseCheckbox.checked = data.WillTakeThaiLicense === true;
        }
        if (data.profilePictureUrl) {
            document.getElementById('avatarPreview').style.backgroundImage = `url('${data.profilePictureUrl}')`;
            existingPictureId = data.ProfilePictureID;
        }
    }
</script>