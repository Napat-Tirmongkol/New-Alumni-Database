<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <style>
      .donation-page {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
        max-width: 1200px;
        margin: auto;
      }

      .form-column,
      .info-column {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      .card {
        background-color: white;
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .card h2 {
        margin-top: 0;
        font-size: 1.25rem;
        border-bottom: 1px solid #eee;
        padding-bottom: 0.75rem;
        margin-bottom: 1rem;
      }

      .form-column .card h2 {
        color: rgb(234, 88, 12);
      }

      .form-group {
        margin-bottom: 1rem;
      }

      .form-group label {
        display: block;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 1rem;
        box-sizing: border-box;
      }

      .form-group textarea {
        min-height: 100px;
        resize: vertical;
      }

      /* ให้ container เป็น block (ไม่บีบให้กึ่งกลางแนวตั้ง) */
      .upload-container {
        border: 2px dashed #d1d5db;
        border-radius: 0.5rem;
        padding: 1.5rem;
        transition: border-color 0.2s ease-in-out;
        min-height: 180px;
        display: block; /* ปรับจาก flex เป็น block เพื่อให้ .upload-area จัด layout */
        box-sizing: border-box;
      }

      /* บังคับให้ label เป็น flex column (ไอคอนอยู่บรรทัดบน ข้อความบรรทัดล่าง) */
      #uploadArea,
      .upload-area {
        display: flex !important;
        flex-direction: column !important; /* วางจากบนลงล่าง */
        align-items: center;
        justify-content: flex-start; /* อยากให้เริ่มจากด้านบนของกล่อง */
        width: 100%;
        height: 100%;
        gap: 6px; /* ช่องว่างระหว่าง icon/text */
        text-align: center;
        padding-top: 6px; /* ยกลงเล็กน้อย ถ้าต้องการให้ชิดบน */
        box-sizing: border-box;
      }

      .upload-area:hover .upload-icon {
        color: #3b82f6;
      }

      .upload-icon {
        font-size: 2.5rem;
        color: #9ca3af;
        margin: 0;
        line-height: 1;
      }

      .upload-text,
      .upload-hint {
        display: block;
        line-height: 1.2;
      }

      #uploadPreview {
        margin-top: 1rem;
        text-align: center;
      }

      #slipPreview {
        max-width: 100%;
        max-height: 200px;
        object-fit: contain;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
      }

      #fileName {
        font-size: 0.875rem;
        color: #4b5563;
        margin-top: 0.5rem;
        word-break: break-all;
      }

      .hidden {
        display: none;
      }

      .submit-btn {
        width: 100%;
        padding: 1rem;
        font-size: 1rem;
        font-weight: 600;
        color: white;
        background-color: #16a34a;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }

      .submit-btn:disabled {
        background-color: #9ca3af;
      }

      .info-card ul {
        padding-left: 1.25rem;
        margin: 0;
        color: #4b5563;
      }

      .info-card li {
        margin-bottom: 0.5rem;
      }

      .bank-info {
        border-left: 3px solid #4f46e5;
        padding-left: 1rem;
        margin-bottom: 1rem;
      }

      .bank-info p {
        margin: 0.25rem 0;
      }

      .tax-info {
        background-color: #fefce8;
        border: 1px solid #fde68a;
        padding: 1rem;
        border-radius: 6px;
        font-size: 0.875rem;
      }

      .text-orange-600 {
        --tw-text-opacity: 1;
        color: rgb(234 88 12 / var(--tw-text-opacity, 1));
      }

      .contact-info p {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin: 0.5rem 0;
      }
    </style>
  </head>

  <body>
    <div class="donation-page">
      <div class="form-column">
        <div class="card">
          <h2 class="text-orange-600">แจ้งความประสงค์บริจาค</h2>
          <form id="donationForm">
            <div class="form-group">
              <label for="amount">จำนวนเงินที่ต้องการบริจาค</label
              ><input
                type="number"
                id="amount"
                placeholder="0.00"
                required
              />
            </div>
            <div class="form-group">
              <label for="purpose">วัตถุประสงค์การบริจาค</label
              ><select id="purpose" required>
                <option value="">เลือกวัตถุประสงค์</option>
                <option value="education_fund">ทุนการศึกษา</option>
                <option value="equipment_fund">อุปกรณ์การเรียนการสอน</option>
                <option value="building_fund">พัฒนาอาคารสถานที่</option>
                <option value="research_fund">สนับสนุนการวิจัย</option>
                <option value="general_activities_fund">กิจกรรมทั่วไป</option>
                <option value="other">อื่นๆ</option>
              </select>
            </div>
            <div class="form-group">
              <label for="message">ข้อความเพิ่มเติม</label
              ><textarea
                id="message"
                placeholder="ข้อความที่ต้องการส่งถึงคณะ(ไม่บังคับ)"
              ></textarea>
            </div>

            <h4 style="margin-top: 2rem; margin-bottom: 1rem">
              ข้อมูลสำหรับออกใบกำกับภาษี
            </h4>
            <div class="form-group">
              <label for="donorName">ชื่อ-นามสกุล/ชื่อบริษัท</label
              ><input type="text" id="donorName" />
            </div>

            <div class="form-group">
              <label for="donorTaxId">เลขประจำตัวผู้เสียภาษี (13 หลัก)</label>
              <input
                type="text"
                id="donorTaxId"
                pattern="[0-9]{13}"
                maxlength="13"
              />
            </div>

            <div class="form-group">
              <label for="donorAddress"
                >ที่อยู่ผู้บริจาคที่ออกในใบกำกับภาษี</label
              ><textarea id="donorAddress"></textarea>
            </div>

            <div class="form-group">
              <label>อัปโหลดสลิปการโอนเงิน</label>
              <div class="upload-container">
                <input
                  type="file"
                  id="slipFile"
                  accept=".jpg,.jpeg,.png,.pdf"
                  class="hidden"
                  required
                />
                <label for="slipFile" id="uploadArea" class="upload-area">
                  <i class="fas fa-cloud-upload-alt upload-icon"></i>
                  <span class="upload-text"
                    >คลิกเพื่ออัปโหลดสลิปการโอนเงิน</span
                  >
                  <span class="upload-hint">รองรับไฟล์ JPG, PNG, PDF</span>
                </label>
                <div id="uploadPreview" class="hidden">
                  <img id="slipPreview" src="" alt="Slip Preview" />
                  <p id="fileName"></p>
                </div>
              </div>
            </div>
            <button type="submit" id="submitBtn" class="submit-btn">
              ยืนยันการบริจาค
            </button>
          </form>
        </div>
      </div>
      <div class="info-column">
        <div class="card info-card">
          <h2 class="text-orange-600">ข้อมูลการโอนเงิน</h2>
          <div class="bank-info">
            <p><strong>ธนาคารไทยพาณิชย์</strong></p>
            <p>ชื่อบัญชี: คณะพยาบาลศาสตร์ มหาวิทยาลัยอัสสัมชัญ</p>
            <p>เลขที่บัญชี: <strong>123-4-56789-0</strong></p>
          </div>
          <div class="bank-info" style="border-left-color: #0284c7">
            <p><strong>ธนาคารกรุงไทย</strong></p>
            <p>ชื่อบัญชี: คณะพยาบาลศาสตร์ มหาวิทยาลัยอัสสัมชัญ</p>
            <p>เลขที่บัญชี: <strong>987-6-54321-0</strong></p>
          </div>
        </div>
        <div class="card info-card tax-info">
          <h2 class="text-orange-600">สิทธิประโยชน์ทางภาษี</h2>
          <ul>
            <li>สามารถนำไปลดหย่อนภาษีได้ 100% ของจำนวนเงินบริจาค</li>
            <li>ไม่เกิน 10% ของเงินได้สุทธิ หรือไม่เกิน 200,000 บาท</li>
            <li>
              ใบกำกับภาษีจะถูกส่งภายใน 30 วันหลังเจ้าหน้าที่ได้รับการบริจาค
            </li>
          </ul>
          <p style="margin-top: 1rem; font-weight: 600">
            หมายเหตุ:
            การบริจาคเพื่อการศึกษาให้กับสถาบันการศึกษาที่ได้รับการยอมรับ
            สามารถนำไปลดหย่อนภาษีได้สองเท่า
          </p>
        </div>
        <div class="card info-card">
          <h2 class="text-orange-600">ติดต่อสอบถาม</h2>
          <div class="contact-info">
            <p><i class="fas fa-phone-alt"></i> 02-719-1234 ต่อ 5678</p>
            <p><i class="fas fa-envelope"></i> donation@nursing.au.edu</p>
            <p><i class="fas fa-clock"></i> จันทร์-ศุกร์ 8:30-16:30 น.</p>
          </div>
        </div>
      </div>
    </div>
    <script>
      document
        .getElementById("slipFile")
        .addEventListener("change", function (event) {
          const file = event.target.files[0];
          const uploadArea = document.getElementById("uploadArea");
          const uploadPreview = document.getElementById("uploadPreview");
          const slipPreview = document.getElementById("slipPreview");
          const fileNameDisplay = document.getElementById("fileName");
          if (file) {
            uploadArea.classList.add("hidden");
            uploadPreview.classList.remove("hidden");
            fileNameDisplay.textContent = file.name;
            if (file.type.startsWith("image/")) {
              const reader = new FileReader();
              reader.onload = function (e) {
                slipPreview.src = e.target.result;
                slipPreview.style.display = "block";
              };
              reader.readAsDataURL(file);
            } else {
              slipPreview.style.display = "none";
            }
          }
        });
      document
        .getElementById("donationForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const submitBtn = document.getElementById("submitBtn");
          submitBtn.disabled = true;
          submitBtn.textContent = "กำลังส่งข้อมูล...";
          const file = document.getElementById("slipFile").files[0];
          if (!file) {
            alert("กรุณาอัปโหลดสลิปการโอนเงิน");
            submitBtn.disabled = false;
            submitBtn.textContent = "ยืนยันการบริจาค";
            return;
          }
          const reader = new FileReader();
          reader.onload = function (event) {
            const fileData = {
              base64: event.target.result.split(",")[1],
              mimeType: file.type,
              fileName: file.name,
            };
            sendDataToServer(fileData);
          };
          reader.readAsDataURL(file);
        });
      function sendDataToServer(fileData) {
        const userEmail = sessionStorage.getItem("userEmail");
        const donationData = {
          userEmail: userEmail,
          amount: document.getElementById("amount").value,
          purpose: document.getElementById("purpose").value,
          message: document.getElementById("message").value,
          donorName: document.getElementById("donorName").value,
          donorTaxId: document.getElementById("donorTaxId").value,
          donorAddress: document.getElementById("donorAddress").value,
          file: fileData,
        };
        google.script.run
          .withSuccessHandler(onSaveSuccess)
          .saveDonationRecord(donationData);
      }
      function onSaveSuccess(result) {
        alert(result.message);
        const submitBtn = document.getElementById("submitBtn");
        submitBtn.disabled = false;
        submitBtn.textContent = "ยืนยันการบริจาค";
        if (result.success) {
          document.getElementById("donationForm").reset();
          document.getElementById("uploadArea").classList.remove("hidden");
          document.getElementById("uploadPreview").classList.add("hidden");
          document.getElementById("slipPreview").src = "";
          document.getElementById("fileName").textContent = "";
        }
      }
    </script>
  </body>
</html>
